<!DOCTYPE html>
<html>
<head>
    <title>Strata-Scan: Rapid Fleet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* SAME STYLES AS BEFORE, JUST SIMPLIFIED */
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; overflow: hidden; }
        .slide-container { display: flex; transition: transform 0.3s ease-in-out; width: 300vw; height: 100vh; }
        .slide { width: 100vw; height: 100%; padding: 15px; box-sizing: border-box; }
        .card { background: #1a1a1a; padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #333; }
        .btn { padding: 20px; border-radius: 12px; border: none; width: 100%; font-size: 1.2rem; font-weight: 800; cursor: pointer; color: white; }
        .big-input { width: 100%; padding: 15px; background: #333; color: #fff; border: 2px solid #555; border-radius: 8px; font-size: 1.5rem; text-align: center; box-sizing: border-box; }
        
        /* The "Traffic Light" Logic */
        .status-box { padding: 20px; text-align: center; border-radius: 10px; font-weight: bold; font-size: 1.2rem; margin-top: 10px; border: 4px solid #444; background: #222; }
        .safe { border-color: #28a745; color: #28a745; }
        .warn { border-color: #f39c12; color: #f39c12; animation: blink 1s infinite; }
        .danger { border-color: #d9534f; color: #d9534f; background: #300; animation: blink 0.5s infinite; }
        @keyframes blink { 50% { opacity: 0.7; } }

        /* Navigation */
        .navbar { position: fixed; bottom: 0; width: 100%; height: 70px; background: #111; display: flex; border-top: 2px solid #333; }
        .nav-item { flex: 1; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #555; }
        .nav-item.active { color: #0cf; border-top: 3px solid #0cf; background: #222; }
    </style>
</head>
<body onload="init()">

<div class="slide-container" id="mainSlider">
    
    <div class="slide">
        <h2 style="color:#0cf; margin-top:0;">1. LOCATION</h2>
        <div class="card">
            <label>Current Drop</label>
            <input type="text" id="dropID" class="big-input" value="A" style="text-transform:uppercase;">
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn" onclick="setPos('L')" style="background:#333;">L</button>
                <button class="btn" onclick="setPos('C')" style="background:#0cf; color:#000;">C</button>
                <button class="btn" onclick="setPos('R')" style="background:#333;">R</button>
            </div>
            <div style="text-align:center; font-size:3rem; font-weight:900; color:#fff; margin-top:10px;" id="fullID">A-12-C</div>
        </div>
        <div class="card">
             <label>Floor #</label>
             <div style="display:flex; gap:10px;">
                 <button class="btn" style="background:#444;" onclick="modFloor(-1)">-</button>
                 <span id="floorVal" style="font-size:2.5rem; font-weight:bold; padding:0 20px;">12</span>
                 <button class="btn" style="background:#444;" onclick="modFloor(1)">+</button>
             </div>
        </div>
        <button class="btn" style="background:#28a745; margin-top:20px;" onclick="goToSlide(1)">START SCAN >></button>
    </div>

    <div class="slide">
        <h2 style="color:#f39c12; margin-top:0;">2. SCAN & VERIFY</h2>
        
        <div class="card" style="border-color:#f39c12;">
            <label style="color:#f39c12;">STEP 1: REFERENCE TEMP (DRY AREA)</label>
            <div style="display:flex; gap:10px; margin-top:5px;">
                <input type="number" id="refTemp" class="big-input" placeholder="75.0" oninput="calcAlarm()">
                <div style="padding:10px; background:#333; border-radius:8px; width:120px; text-align:center;">
                    <div style="font-size:0.6rem; color:#aaa;">ALARM TRIGGER</div>
                    <div id="alarmVal" style="font-size:1.8rem; font-weight:bold; color:#f39c12;">--°</div>
                </div>
            </div>
        </div>

        <div class="card">
            <label style="color:#fff;">STEP 2: FINDINGS</label>
            <input type="number" id="foundTemp" class="big-input" placeholder="Enter Coldest Temp..." oninput="calcAlarm()">
            
            <div id="statusBox" class="status-box safe">WAITING FOR INPUT</div>

            <div id="confirmationTools" style="display:none; margin-top:15px; border-top:1px solid #555; padding-top:15px;">
                <label style="color:#d9534f;">⚠️ ANOMALY DETECTED</label>
                <button class="btn" id="meterBtn" style="background:#333; border:2px solid #555; margin-top:5px;" onclick="toggleMeter()">
                    CONFIRM WITH SURVEYMASTER
                </button>
            </div>
        </div>

        <button class="btn" style="background:#007bff; margin-top:10px;" onclick="logData()">LOG & NEXT WINDOW</button>
    </div>

    <div class="slide">
        <h2 style="color:#ccc; margin-top:0;">3. HISTORY</h2>
        <div id="logList" style="height:60vh; overflow-y:auto; background:#111; padding:10px; border-radius:10px;">
            </div>
        <button class="btn" style="background:#444; margin-top:10px;" onclick="exportCSV()">EXPORT CSV</button>
    </div>
</div>

<div class="navbar">
    <div class="nav-item active" onclick="goToSlide(0)">LOCATE</div>
    <div class="nav-item" onclick="goToSlide(1)">SCAN</div>
    <div class="nav-item" onclick="goToSlide(2)">LOGS</div>
</div>

<script>
    let floor = 12;
    let pos = 'C';
    let logs = [];

    function init() { calcAlarm(); }

    function setPos(p) { 
        pos = p; 
        document.getElementById('fullID').innerText = document.getElementById('dropID').value + '-' + floor + '-' + p;
    }

    function modFloor(n) {
        floor += n;
        document.getElementById('floorVal').innerText = floor;
        setPos(pos);
    }

    function calcAlarm() {
        const ref = parseFloat(document.getElementById('refTemp').value);
        const found = parseFloat(document.getElementById('foundTemp').value);
        const box = document.getElementById('statusBox');
        const tools = document.getElementById('confirmationTools');
        
        if (!ref) { 
            document.getElementById('alarmVal').innerText = "--"; 
            return; 
        }

        // THE MAGIC NUMBER: 3 DEGREES
        const limit = ref - 3.0;
        document.getElementById('alarmVal').innerText = limit.toFixed(1) + "°";

        if (!found) {
            box.innerText = "ENTER SCAN TEMP";
            box.className = "status-box safe";
            tools.style.display = "none";
            return;
        }

        const delta = (ref - found).toFixed(1);

        if (found < limit) {
            // COLDER THAN ALARM = POTENTIAL LEAK
            box.innerText = `⚠️ ANOMALY (Δ -${delta}°F)`;
            box.className = "status-box danger";
            tools.style.display = "block";
            if (navigator.vibrate) navigator.vibrate(200);
        } else if (found < ref) {
            // COLDER, BUT NOT CRITICAL
            box.innerText = `COOLING (Δ -${delta}°F)`;
            box.className = "status-box warn";
            tools.style.display = "none";
        } else {
            // WARMER OR EQUAL
            box.innerText = "NO THERMAL ANOMALY";
            box.className = "status-box safe";
            tools.style.display = "none";
        }
    }

    function toggleMeter() {
        const btn = document.getElementById('meterBtn');
        if (btn.innerText.includes("CONFIRM")) {
            btn.style.background = "#d9534f";
            btn.innerText = "MOISTURE CONFIRMED ✅";
        } else {
            btn.style.background = "#333";
            btn.innerText = "CONFIRM WITH SURVEYMASTER";
        }
    }

    function logData() {
        const id = document.getElementById('fullID').innerText;
        const ref = document.getElementById('refTemp').value;
        const found = document.getElementById('foundTemp').value;
        const meter = document.getElementById('meterBtn').innerText.includes("✅") ? "WET" : "DRY";
        
        const logEntry = `<div style="border-bottom:1px solid #333; padding:10px; font-size:0.8rem;">
            <strong style="color:#0cf">${id}</strong> | Ref: ${ref}° | Found: ${found}°<br>
            Result: <span style="color:${meter==='WET'?'#d9534f':'#ccc'}">${meter}</span>
        </div>`;
        
        document.getElementById('logList').insertAdjacentHTML('afterbegin', logEntry);
        
        // Reset for next window
        document.getElementById('foundTemp').value = "";
        document.getElementById('meterBtn').innerText = "CONFIRM WITH SURVEYMASTER";
        document.getElementById('meterBtn').style.background = "#333";
        document.getElementById('confirmationTools').style.display = "none";
        goToSlide(0); // Go back to Map to change window/position
    }

    function goToSlide(n) {
        document.getElementById('mainSlider').style.transform = `translateX(-${n * 100}vw)`;
    }
    
    function exportCSV() {
        alert("Exporting CSV...");
    }
</script>
</body>
</html>
